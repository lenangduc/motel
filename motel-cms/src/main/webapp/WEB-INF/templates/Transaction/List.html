<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title> Danh sách yêu cầu </title>
    <content th:replace="fragments/init :: head"></content>
</head>
<style>
    #email_errors {
        padding: 11px;
        margin-bottom: 0px;
        margin-top: 15px;
    }

</style>
<body class="nav-md">
<input type="hidden" id="application-context" th:value="@{/}"/>
<div class="container body">
    <div class="main_container">
        <content th:replace="fragments/menu-bar :: content"></content>
        <div class="top_nav">
            <div class="nav_menu" style="background-color: seagreen">
                <nav>
                    <div class="nav toggle">
                        <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                    </div>
                    <div class="nav toggle" style="width: auto;padding-top: 10px">
                        <b id="titlePage" style="font-size: x-large; color: white">Danh sách yêu cầu </b>
                    </div>
                    <div class="nav navbar-nav navbar-right">
                        <content th:replace="fragments/top-nav :: li_user"></content>
                    </div>
                </nav>
            </div>
        </div>

        <div class="right_col" role="main" style="min-height: 100vh">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_content">
                            <!--                            <form role="form" th:action="@{/ctv/}"-->
                            <!--                                  method="GET">-->
                            <!--                                <div class="row">-->
                            <!--                                    <div class="col-lg-3 col-sm-4 col-xs-12">-->
                            <!--                                        <label>Từ ngày - Đến ngày</label>-->
                            <!--                                        <div class="input-prepend input-group">-->
                            <!--                                            <span class="add-on input-group-addon"><i-->
                            <!--                                                    class="glyphicon glyphicon-calendar fa fa-calendar"></i></span>-->
                            <!--                                            <input type="text" name="from_date" id="from_date" hidden="true"-->
                            <!--                                                   th:value="${from_date}"/>-->
                            <!--                                            <input type="text" name="to_date" id="to_date" hidden="true" th:value="${to_date}"/>-->
                            <!--                                            <input type="text" style="width: 100%" name="date_range" id="reservationtime"-->
                            <!--                                                   class="form-control span4" th:value="${from_date} + ' - ' + ${to_date}"-->
                            <!--                                                   readonly="readonly"/>-->
                            <!--                                        </div>-->
                            <!--                                    </div>-->
                            <!--                                    <div class="col-lg-3 col-xs-4 col-sm-12">-->
                            <!--                                        <label>&nbsp;</label>-->
                            <!--                                        <div>-->
                            <!--                                            <button type="submit" id="btnSearch" class="btn btn-round btn-basic-yotel"><i-->
                            <!--                                                    class="fa fa-search"></i>-->
                            <!--                                                Tìm kiếm-->
                            <!--                                            </button>-->
                            <!--                                        </div>-->
                            <!--                                    </div>-->
                            <!--                                </div>-->
                            <!--                            </form>-->
                            <div class="panel-table-wrapper custom-scroll" style="overflow-x:auto;">
                                <table class="table table-responsive table-striped table-bordered table-hover">
                                    <thead>
                                    <th>Stt</th>
                                    <th>Mã bài</th>
                                    <th>Ngày yêu cầu</th>
                                    <th>Thời hạn (/Ngày)</th>
                                    <th>Giá tiền (VNĐ)</th>
                                    <th>Trạng thái</th>
                                    </thead>
                                    <tbody th:if="${trans} != null">
                                    <tr th:each="tran, iterStat : ${trans}">
                                        <td th:text="${iterStat.count}"></td>
                                        <td th:text="${tran.postId}"></td>
                                        <td th:text="${#dates.format(tran.dateRequest, 'dd/MM/yyyy')}"></td>
                                        <td th:text="${tran.duration}"></td>
                                        <td th:text="${tran.money}"></td>
                                        <td >
                                            <span th:id="'statusId'+${tran.id}" th:if="${tran.status} == 1"
                                                  th:onclick="'changeStatus(\''+ ${tran.id} +'\')'" th:status="${tran.status}">
                                                <input type="checkbox" class="js-switch" style="display: none" checked/>
                                            </span>
                                            <span th:id="'statusId'+${tran.id}" th:if="${tran.status} == 0"
                                                  th:onclick="'changeStatus(\''+ ${tran.id} +'\')'" th:status="${tran.status}">
                                                <input type="checkbox" class="js-switch" style="display: none" />
                                            </span>
                                            <span th:if="${tran.status} == 1">Đã thanh toán</span>
                                            <span th:if="${tran.status} == 0" style="color: orangered"> Chưa thanh toán </span>
                                        </td>
                                    </tbody>
                                </table>
                            </div>
                            <!--                                                        <content th:replace="fragments/panigator :: content(page = ${post})"></content>-->
                        </div>
                    </div>
                </div>
            </div>
            <!-- row -->
        </div>
    </div>
    <content th:replace="fragments/footer :: content"></content>
</div>
<!-- /#wrapper -->

<content th:replace="fragments/init :: script"></content>
<script type="text/javascript">
    function changeStatus(id) {
        var currentStatus = $('#statusId'+ id).attr("status");
        console.log("currentStatus " + currentStatus)
        var statusChangeTo;
        if (currentStatus == 0) {
            statusChangeTo = 1;
            $('#statusId'+ id).attr("status", "1");
        } else if (currentStatus == 1) {
            statusChangeTo = 0;
            $('#statusId'+ id).attr("status", "0");
        }

        if (statusChangeTo == null) return ;

        $.ajax({
            url: APPLICATION_CONTEXT + "transaction/update-status",
            type: 'GET',
            headers: {
                // Accept : "application/json"
            },
            data: {
                status: statusChangeTo,
                id:id
            },
            success: function (result) {
                console.log(result);
            },
        })
    }

    $('#reservationtime').daterangepicker({
        timePicker: false,
        "showDropdowns": true,
        format: 'DD/MM/YYYY'
    }, function (start, end, label) {
        $('#from_date').val(start.format('DD/MM/YYYY'));
        $('#to_date').val(end.format('DD/MM/YYYY'));
    });
</script>
</body>

</html>
