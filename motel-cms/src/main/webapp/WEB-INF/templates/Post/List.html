<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title> Danh sách bài đăng</title>
    <content th:replace="fragments/init :: head"></content>
</head>
<style>
    #email_errors {
        padding: 11px;
        margin-bottom: 0px;
        margin-top: 15px;
    }

    .navbar-nav .open .dropdown-menu.msg_list {
        width: 250px;
    }


</style>
<body class="nav-md">
<input type="hidden" id="application-context" th:value="@{/}"/>
<div class="container body">
    <div class="main_container">
        <content th:replace="fragments/menu-bar :: content"></content>
        <div class="top_nav">
            <div class="nav_menu" style="background-color: seagreen">
                <nav>
                    <div class="nav toggle">
                        <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                    </div>
                    <div class="nav toggle" style="width: auto;padding-top: 10px">
                        <b id="titlePage" style="font-size: x-large; color: white">Danh sách bài đăng</b>
                    </div>
                    <div class="nav navbar-nav navbar-right">

                    </div>
                    <div class="nav navbar-nav navbar-right">
                        <li>
                            <content th:replace="fragments/top-nav :: li_user"></content>
                        </li>
                        <li role="presentation" class="nav-item dropdown open"  style="margin-top: 6px">
                            <a href="javascript:;" class="dropdown-toggle info-number" id="navbarDropdown1"
                               data-toggle="dropdown" aria-expanded="false">
                                <i class="fa fa-envelope-o"></i>
                                <span class="badge bg-green">*</span>
                            </a>
                            <ul class="dropdown-menu list-unstyled msg_list" role="menu" id = "notify-list"
                                aria-labelledby="navbarDropdown1" x-placement="bottom-start"
                                style="position: absolute; right: 0px; top: 55px;">
                            </ul>
                        </li>

                    </div>
                </nav>
            </div>
        </div>

        <div class="right_col" role="main" style="min-height: 100vh">
            <div class="row">
                <div class="col-md-12 col-sm-12 col-xs-12">
                    <div class="x_panel">
                        <div class="x_content">
                            <form role="form" th:action="@{/owner/list-post}"
                                  method="GET">
                                <div class="row">
                                    <div class="col-lg-3 col-sm-6 col-xs-12">
                                        <label>Mã post</label>
                                        <div>
                                            <input class="form-control" name="post_id" type="text" placeholder="Mã bài đăng" th:value="${post_id}" >
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-sm-6 col-xs-12">
                                        <label>Trạng thái</label>
                                        <select class="form-control" name="isAccept" id="isAccept" th:value="${isAccept}">
                                            <option th:selected="${isAccept == null}" value=""> Tất cả</option>
                                            <option th:selected="${isAccept == 1 }" value="1"> Đã duyệt</option>
                                            <option th:selected="${isAccept == 0 }" value="0"> Chưa duyệt</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-3 col-xs-4 col-sm-12">
                                        <label>&nbsp;</label>
                                        <div>
                                            <button type="submit" id="btnSearch" class="btn btn-round btn-basic-yotel"><i
                                                    class="fa fa-search"></i>
                                                Tìm kiếm
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </form>
                            <div class="panel-table-wrapper custom-scroll" style="overflow-x:auto;">
                                <table class="table table-responsive table-striped table-bordered table-hover">
                                    <thead>
                                    <th>Stt</th>
                                    <th>Mã bài đăng</th>
                                    <th>Ngày đăng</th>
                                    <th>Ngày hết hạn</th>
                                    <th>Địa điểm</th>
                                    <th>TT duyệt</th>
                                    <th>TT thuê</th>
                                    <th>Chi tiết</th>
                                    <th>Gia hạn</th>
                                    </thead>
                                    <tbody th:if="${posts} != null">
                                    <tr th:each="post, iterStat : ${posts}">
                                        <td th:text="${iterStat.count}"></td>
                                        <td th:text="${post.postId}"></td>
                                        <td th:text="${#dates.format(post.datePost, 'dd/MM/yyyy')}"></td>
                                        <td th:text="${#dates.format(post.dateExpired, 'dd/MM/yyyy')}"></td>
                                        <td th:text="${post.addressRoom}"></td>
                                        <td>
                                            <span th:if="${post.isAccept} == 1">Đã duyệt</span>
                                            <span th:if="${post.isAccept} == 0"
                                                  style="color: orangered"> Chưa duyệt </span>
                                            <span th:if="${post.isAccept} == -1"> Từ chối </span>
                                            <span th:if="${post.isAccept} == 2"> Hết hạn </span>
                                        </td>
                                        <td>
                                            <span th:id="'statusId'+${post.id}" th:if="${post.isRental} == 1"
                                                  th:onclick="'changeStatus(\''+ ${post.id} +'\')'"
                                                  th:status="${post.isRental}">
                                                <input type="checkbox" class="js-switch" style="display: none" checked/>
                                            </span>
                                            <span th:id="'statusId'+${post.id}" th:if="${post.isRental} == 0"
                                                  th:onclick="'changeStatus(\''+ ${post.id} +'\')'"
                                                  th:status="${post.isRental}">
                                                <input type="checkbox" class="js-switch" style="display: none"/>
                                            </span>
                                            <span th:if="${post.isRental} == 1">Đã thuê</span>
                                            <span th:if="${post.isRental} == 0"
                                                  style="color: orangered"> Chưa thuê </span>
                                        </td>

                                        <td class="text-center">
                                            <a th:href="@{'/owner/show/' + ${post.id}}">
                                                <button type="button" class="btn btn-round btn-basic-yotel btn-sm-yotel"
                                                        title="Cụ thể"><i
                                                        class="fa fa-eye"> </i>
                                                </button>
                                            </a>
                                        </td>
                                        <td class="text-center" th:if="${post.status} == -1">
                                            <a th:href="@{'/owner/show/extend/' + ${post.id}}">
                                                <button type="button"
                                                        class="btn btn-round btn-basic-yotel btn-sm-yotel"><i
                                                        class="fa fa-pencil"> </i>
                                                </button>
                                            </a>
                                        </td>
                                        <td class="text-center" th:if="${post.status} == 1">
                                            <button type="button" class="btn btn-round btn-basic-yotel btn-sm-yotel"
                                                    title="Chưa hết hạn">
                                                <i class="fa fa-pencil"> </i>
                                            </button>
                                        </td>
                                    </tbody>
                                </table>
                            </div>
<!--                            <content th:replace="fragments/panigator :: content(page = ${post})"></content>-->
                        </div>
                    </div>
                </div>
            </div>
            <!-- row -->
        </div>
    </div>
    <content th:replace="fragments/footer :: content"></content>
</div>
<!-- /#wrapper -->

<content th:replace="fragments/init :: script"></content>
<script type="text/javascript">
    setInterval(function () {
        $.ajax({
            url: APPLICATION_CONTEXT + "notification/list",
            type: 'GET',
            headers: {
                accept: 'application/json'
            },
            data: {},
            success: function (result) {
                var notifyContentHtml = '';
                for (var li of result) {
                    notifyContentHtml  += `
                        <li class="nav-item">
                            <a class="dropdown-item">
                            <span class="message">${li.content}</span>
                            </a>
                        </li>
                    `;
                }
                $('#notify-list').html(notifyContentHtml);
            },
        }).always(function (ketqua) {
        });
    }, 3000)

    function changeStatus(id) {
        var currentStatus = $('#statusId' + id).attr("status");
        console.log("currentStatus " + currentStatus)
        var statusChangeTo;
        if (currentStatus == 0) {
            statusChangeTo = 1;
            $('#statusId' + id).attr("status", "1");
        } else if (currentStatus == 1) {
            statusChangeTo = 0;
            $('#statusId' + id).attr("status", "0");
        }

        if (statusChangeTo == null) return;

        $.ajax({
            url: APPLICATION_CONTEXT + "owner/update-is-rental",
            type: 'GET',
            headers: {
                // Accept : "application/json"
            },
            data: {
                status: statusChangeTo,
                id: id
            },
            success: function (result) {
                console.log(result);
            },
        })
    }

    function changeIsAccept(id) {
        var currentStatus = $('#statusId' + id).attr("status");
        console.log("currentStatus " + currentStatus)
        var statusChangeTo;
        if (currentStatus == 0) {
            statusChangeTo = 1;
            $('#statusId' + id).attr("status", "1");
        } else if (currentStatus == 1) {
            statusChangeTo = 0;
            $('#statusId' + id).attr("status", "0");
        }

        if (statusChangeTo == null) return;

        $.ajax({
            url: APPLICATION_CONTEXT + "owner/update-is-accept",
            type: 'GET',
            headers: {
                // Accept : "application/json"
            },
            data: {
                status: statusChangeTo,
                id: id
            },
            success: function (result) {
                console.log(result);
            },
        })
    }

</script>
<script type="text/javascript">

    $('#reservationtime').daterangepicker({
        timePicker: false,
        "showDropdowns": true,
        format: 'DD/MM/YYYY'
    }, function (start, end, label) {
        $('#from_date').val(start.format('DD/MM/YYYY'));
        $('#to_date').val(end.format('DD/MM/YYYY'));
    });
</script>
</body>

</html>
